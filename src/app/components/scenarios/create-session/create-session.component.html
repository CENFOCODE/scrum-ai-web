<div id="csd-session" *ngIf="selectedScenario">
  <div>
    <section id="csd-session-col" class="container my-4">
      <div id="csd-session-card" class="card p-3 shadow-sm">

        <div *ngIf="notice() as n" class="csd-notice" [ngClass]="'csd-notice--' + n.type" role="alert">
          <div class="csd-notice__icon" aria-hidden="true">
            <svg *ngIf="n.type === 'success'" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
              <path d="M7 12l3 3 7-7" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <svg *ngIf="n.type === 'warning'" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
              <line x1="12" y1="7" x2="12" y2="13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <circle cx="12" cy="17" r="1.5" fill="currentColor"/>
            </svg>
            <svg *ngIf="n.type === 'error'" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
              <path d="M8 8l8 8M16 8l-8 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </div>
          <div class="csd-notice__text">{{ n.text }}</div>

          <button type="button" class="csd-notice__close" (click)="closeNotice()">Cerrar</button>
        </div>



        <!-- Header -->
        <header id="csd-session-header" class="mb-3">
          <h2 id="csd-title" class="mb-2">{{ selectedScenario.ceremonyType }}</h2>
           Usuario actual: <strong>{{ authService.getUser()?.name }}</strong>
        </header>

        <div id="csd-grid" class="csd-grid">
          <!-- Objectives -->
          <div id="csd-objectives" class="csd-surface">
            <h3 id="csd-objectives-title" class="mb-2">Objetivos</h3>
            <p id="csd-objectives-text" class="mb-0">{{ selectedScenario.description }}</p>
          </div>

          <!-- Rol / difficulty -->
          <div id="csd-options" class="csd-col">
            <p id="csd-options-title" class="mb-2"> Antes de empezar, seleccione la dificultad y rol </p>
            <div id="csd-selects" class="csd-selects">
              <!-- Difficulty -->
              <mat-form-field id="csd-select-difficulty-ff" appearance="outline" class="csd-ff">
                <mat-select id="csd-select-difficulty" [(ngModel)]="selectedDifficulty" panelClass="csd-select-panel" disableOptionCentering placeholder="Dificultad" required>
                  <mat-option *ngFor="let diff of difficultyLevels" [value]="diff" >
                    {{ diff }}
                  </mat-option>
                </mat-select>
              </mat-form-field>

              <!-- Role -->
              <mat-form-field id="csd-select-role-ff" appearance="outline" class="csd-ff">
                <mat-select id="csd-select-role" [(ngModel)]="selectedRole" panelClass="csd-select-panel" disableOptionCentering placeholder="Rol" required>
                  <mat-option *ngFor="let role of scrumRoles" [value]="role">
                    {{ role }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <!-- Email para invitar -->
            <div class="mt-2">
              <p class="invite-label">Invita a tu equipo</p>
              <mat-form-field id="csd-invite-email-ff" appearance="outline" class="csd-ff">
                <input matInput placeholder="Email" type="email" name="inviteEmail" />
              </mat-form-field>
            </div>
          </div>

          <!-- Scene -->
          <div id="csd-scenario" class="csd-surface">
            <h3 id="csd-scenario-title" class="mb-2">Backlog</h3>
            <p id="csd-scenario-text" class="mb-0">{{ selectedScenario.backlog }}</p>
          </div>

          <!-- Participants -->
          <aside id="csd-participants" class="csd-surface">
            <h3 id="csd-participants-title" class="mb-2">Participantes</h3>
            <ul id="csd-participants-list" class="list-unstyled mb-0">
              <li>{{ selectedScenario.team }}</li>
            </ul>
          </aside>
        </div>

        <div id="csd-actions" class="d-flex justify-content-end mt-3">
          <button mat-raised-button color="primary" (click)="createSimulation()" [disabled]="isLoading">
    {{ isLoading ? 'Creando...' : 'Inciar Ceremonia' }}
  </button>
        </div>
      </div>
    </section>
  </div>
</div>